# Pandas

## Creating DataFrames

```{python}
import json
import pandas as pd

class Person:
    NAME = 'name'
    AGE = 'age'
    CITY = 'city'
    SALARY = 'salary'

# from dict
data = {
    Person.NAME : ['Alice', 'Bob', 'Charlie', 'David'],
    Person.AGE : [25, 30, 35, 40],
    Person.CITY : ['NYC', 'SF', 'LA', 'NYC'],
    Person.SALARY : [70000, 80000, 90000, 95000]
}

df_from_dict = pd.DataFrame(data)
print(df_from_dict[Person.NAME])

# From list of dictionaries
records = [
    {'name': 'Alice', 'age': 25},
    {'name': 'Bob', 'age': 30}
]

df_from_list = pd.DataFrame(records)
print(df_from_list)

# from JSON
json_data = '[{"name": "Alice", "age": 25}, {"name": "Bob", "age": 30}]'
json_parsed = json.loads(json_data)
df_from_json = pd.DataFrame(json_parsed)
print(df_from_json)
```

## Basic operations

```{python}
import pandas as pd
from pandas import DataFrame
import numpy as np

is_printable = True

np.random.seed(42)

data = {
    'name': [f'Person_{i}' for i in range(1, 51)],
    'age': np.random.randint(18, 65, 50),
    'city': np.random.choice(['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose'], 50),
    'salary': np.random.randint(30000, 120000, 50)
}

basic_df: DataFrame = pd.DataFrame(data)

if is_printable:
    print("First 5 rows:")
    print(basic_df.head())
    print("\nLast 5 rows:")
    print(basic_df.tail())
    print("\nDataFrame info:")
    print(basic_df.info())
    print("\nDescriptive statistics:")
    print(basic_df.describe())
    print("\nMean age:")
    print(basic_df['age'].mean())
    print("\nMedian age:")
    print(basic_df['age'].median())
    print("\nStandard deviation of age:")
    print(basic_df['age'].std())

print("\nManual median calculation:")
row_count = len(basic_df)
ageSorted = basic_df['age'].sort_values()

if( row_count % 2 == 0):
    median = (ageSorted.iloc[row_count // 2] + ageSorted.iloc[row_count // 2 - 1]) / 2
else:
    median = ageSorted.iloc[row_count // 2]
print(median)


print("\n filtering: age > 40 ")
print(basic_df[basic_df['age'] > 40].sort_values('age'))

print("\n filtering: age > 40 and city == 'New York'")
print(basic_df[(basic_df['age'] > 40) & (basic_df['city'] == 'New York')].sort_values('age'))

```

## Pandera - Basic Type-checking
```{python}
import pandas as pd
import pandera.pandas as pa
from pandera.typing import Series, DataFrame

class UserSchema(pa.DataFrameModel):
    name: Series[str] = pa.Field()
    age: Series[int] = pa.Field()
    city: Series[str] = pa.Field()

df: DataFrame[UserSchema] = UserSchema.validate(pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie'],
    'age' : [25, 30, 40],
    'city': ['NYC', 'SF', 'LA']
}))

```

## Pandera: advanced Type-checking

```{python}
import pandas as pd
import pandera.pandas as pa
from pandera.typing import Series, DataFrame
from typing import Literal, get_args, List, Any
import numpy as np

np.random.seed(42)

class Employee:
    NAME = 'name'
    ROLE = 'role'
    SKILLSET = 'skillset'

NameType = Literal['Alice', 'Bob', 'Charlie', 'David', 'Eve']
RoleType = Literal['Sales Manager', 'IT Manager', 'HR Manager', 'Finance Manager', 'Marketing Manager']
SkillsetType = Literal['Sales', 'IT', 'HR', 'Finance', 'Marketing']

class EmployeeSchema(pa.DataFrameModel):
    name: Series[str] = pa.Field(isin=get_args(NameType))
    role: Series[str] = pa.Field(isin=get_args(RoleType))
    skillset: Series[List[str]]
    
    @pa.check("skillset")
    def check_skillset(cls, series: pd.Series) -> pd.Series:
        """Validate that each list contains only valid skill strings"""
        valid_skills = set(get_args(SkillsetType))
        # Use apply with type hint for the lambda
        return series.apply(lambda skill_list: all(str(skill) in valid_skills for skill in skill_list))


# print(list(np.random.choice(get_args(NameType), 50)))

employees_data = {
    Employee.NAME: np.random.choice(get_args(NameType), 50),
    Employee.ROLE: np.random.choice(get_args(RoleType), 50),
    Employee.SKILLSET: [list(np.random.choice(get_args(SkillsetType), 2)) for _ in range(50)]
}

# print(employees_data)

employees_df: DataFrame[EmployeeSchema] = EmployeeSchema.validate(pd.DataFrame(employees_data))

print(employees_df.head(10))

```


## test
```{python}
from typing import Literal, get_args 
import numpy as np

NameTypeTest = Literal['Alice', 'Bob', 'Charlie', 'David', 'Eve']
print(np.random.choice(get_args(NameTypeTest), 50))

```












